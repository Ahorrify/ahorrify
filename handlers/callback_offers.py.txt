# handlers/callback_offers.py

from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, InputMediaPhoto
from telegram.ext import ContextTypes
from data.ofertas_data import ofertas_data

async def enviar_oferta(update: Update, context: ContextTypes.DEFAULT_TYPE, categoria, subcategoria, ciudad):
    idx = context.user_data.get("indice_oferta", 0)
    try:
        lista_ofertas = ofertas_data[categoria][subcategoria][ciudad]
    except KeyError:
        await update.message.reply_text("Lo siento, a칰n no hay ofertas disponibles para esa selecci칩n.")
        return

    if idx < 0 or idx >= len(lista_ofertas):
        await update.message.reply_text("Lo siento, no hay m치s ofertas disponibles.")
        return

    oferta = lista_ofertas[idx]
    caption = (
        f"游낅 *{oferta['nombre']}*\n"
        f"游늸 Direcci칩n: {oferta['direccion']}\n"
        f"游닇 Descripci칩n: {oferta['descripcion']}\n"
        f"游눯 Oferta: {oferta['oferta']}\n"
        f"游 Tel칠fono: {oferta['telefono']}"
    )
    await update.message.reply_photo(
        photo=oferta["imagen"],
        caption=caption,
        parse_mode="Markdown"
    )

    keyboard = [
        [InlineKeyboardButton("游대 Ver otra oferta", callback_data="SIGUIENTE_OFERTA")],
        [InlineKeyboardButton("拘勇 Regresar", callback_data="REGRESAR_MENU")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text("", reply_markup=reply_markup)

    context.user_data["ciudad_actual"] = ciudad
    context.user_data["indice_of